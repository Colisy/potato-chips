(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(3527)}])},3527:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var a=n(5893),s=n(7294),r=n(1799),i=n(9396),c=n(797),l=function(e){var t=e.style;return(0,a.jsxs)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"14592",style:t,children:[(0,a.jsx)("path",{d:"M722.332903 1007.995871a220.688516 220.688516 0 0 1 26.574452-54.404129c23.403355-34.931613 62.728258-87.436387 83.852387-137.992258 34.849032-83.406452 44.577032-272.08671 29.134452-566.040774a47.070968 47.070968 0 0 0-47.004904-44.593549 44.510968 44.510968 0 0 0-44.510967 44.510968v226.237936l-18.332904-324.52542a59.028645 59.028645 0 0 0-58.929548-55.692387A55.774968 55.774968 0 0 0 637.357419 151.287742v270.170839L611.922581 83.125677A71.993806 71.993806 0 0 0 540.143484 16.516129a69.433806 69.433806 0 0 0-69.384258 66.725161l-13.146839 338.217291V157.877677a62.381419 62.381419 0 0 0-62.397935-62.381419 62.034581 62.034581 0 0 0-62.034581 62.381419l1.948903 355.75742-44.477935-100.897032a82.580645 82.580645 0 0 0-75.561291-49.267613h-6.887225A44.923871 44.923871 0 0 0 165.16129 421.326452c14.286452 47.467355 22.709677 78.236903 25.269678 92.325161 19.15871 105.372903 21.256258 190.810839 43.553032 254.018064 16.516129 46.839742 74.487742 110.823226 98.832516 151.882323 15.326968 25.831226 32.503742 55.312516 51.530323 88.443871h337.969548z",fill:"#EED6AA","p-id":"14593"}),(0,a.jsx)("path",{d:"M536.592516 8.340645a77.691871 77.691871 0 0 0-74.091355 74.586839l-1.866322 48.276645-0.974452-2.312258a70.656 70.656 0 0 0-64.445935-41.653677 70.309161 70.309161 0 0 0-70.210065 66.890322l-0.082581 3.782194 1.75071 316.052645-28.45729-64.545032a90.83871 90.83871 0 0 0-83.125678-54.205936h-6.887225a53.181935 53.181935 0 0 0-50.919226 68.492387l8.092903 27.317678 5.400774 18.72929 5.384258 19.489032 3.187613 12.469678 1.767226 7.498322 0.858839 4.129032 0.330322 1.783742c2.840774 15.57471 5.400774 31.248516 7.911226 48.061936l4.129032 29.233548 8.026839 61.44 2.758194 19.951484 1.783742 12.139355 1.783741 11.280516 1.800259 10.520774 1.816774 9.827097 1.866322 9.249032 1.932387 8.704c0.990968 4.228129 2.014968 8.307613 3.088517 12.254968l2.180129 7.762581 1.156129 3.798709 2.411354 7.415742 1.255226 3.666581c6.193548 17.556645 17.672258 37.491613 35.278452 62.893419l6.523871 9.265549 5.648516 7.861677 31.925677 43.371355 3.220646 4.492387 5.797161 8.258065 4.987871 7.399225c2.312258 3.501419 4.343742 6.738581 6.144 9.794065l15.921548 27.020387 17.176774 29.448258 20.760775 36.021677h348.721548l1.866323-5.681548c5.301677-16.185806 12.486194-31.578839 21.570064-46.179097l5.252129-8.010322 26.095484-38.168774 12.403613-18.481549c15.756387-24.064 28.126968-45.155097 37.854968-65.337806 2.543484-5.318194 4.888774-10.520774 7.019354-15.607742 4.789677-11.495226 9.133419-24.87329 12.998194-40.183742l2.246194-9.414194c0.743226-3.204129 1.453419-6.490839 2.147096-9.860129l2.048-10.32258 0.974452-5.33471 1.866322-11.016258 0.875355-5.681549 1.701162-11.726451c0.545032-3.963871 1.073548-8.026839 1.585548-12.155871l1.486452-12.618323 1.354322-13.080774 1.23871-13.543226 1.156129-14.022193 1.007484-14.451613 0.908387-14.930581 0.80929-15.393032 0.693678-15.855484 0.29729-8.092903 0.528516-16.532645 0.396387-17.011613 0.313807-17.457549 0.099096-8.902193 0.165162-27.416774-0.049549-18.828387-0.148645-19.323871-0.429419-29.828129-0.660645-30.868646-0.611097-21.140645-0.693678-21.636129-1.271742-33.296516-1.502967-34.353548-1.767226-35.377549a55.329032 55.329032 0 0 0-55.246452-52.422193l-2.989419 0.08258a52.802065 52.802065 0 0 0-45.799226 32.536775l-1.189161 3.187613-4.624516-81.787871a67.28671 67.28671 0 0 0-67.171097-63.488l-3.303226 0.08258A64.049548 64.049548 0 0 0 629.099355 151.287742v49.796129l-8.91871-118.585806A80.251871 80.251871 0 0 0 540.143484 8.258065l-3.550968 0.08258z m3.550968 16.433549a63.735742 63.735742 0 0 1 63.554064 58.96258l25.401807 338.332903 16.499613-0.611096V151.287742a47.516903 47.516903 0 0 1 47.516903-47.533419 50.770581 50.770581 0 0 1 50.688 47.896774l18.332903 324.525419 16.499613-0.462451V249.476129c0-20.017548 16.218839-36.252903 36.252903-36.252903a38.812903 38.812903 0 0 1 38.763355 36.764903l1.734194 35.080258 1.024 22.808774 1.337806 33.362581 1.090065 32.322064 0.842322 31.281549 0.594581 30.257548 0.264258 19.588129 0.165161 19.142194v27.829677l-0.115613 17.969549-0.231225 17.507096-0.545033 25.434839-0.792774 24.36129-1.040516 23.337291-0.825806 14.980129-0.94142 14.517677-1.040516 14.03871-1.156129 13.60929-1.255226 13.113807-0.660645 6.391742-1.436903 12.436645c-0.743226 6.110968-1.519484 12.040258-2.345291 17.787871l-1.684645 11.280516-1.816774 10.801548a600.030968 600.030968 0 0 1-0.941419 5.235613l-1.96542 10.124387c-0.330323 1.651613-0.660645 3.270194-1.024 4.888774l-2.114064 9.414194-2.246194 8.951742a353.775484 353.775484 0 0 1-1.156129 4.31071l-2.394838 8.258064c-2.444387 8.026839-5.053935 15.36-7.828646 21.999484-2.014968 4.82271-4.244645 9.744516-6.672516 14.814968-8.324129 17.275871-18.762323 35.410581-31.777032 55.725419l-8.91871 13.625807-20.760774 30.554838-14.980129 21.867355-4.294193 6.672516c-8.390194 13.477161-15.293935 27.581935-20.678194 42.330839l-0.594581 1.75071H389.153032l-16.053677-27.813162-22.643613-38.812903-10.520774-17.787871a291.658323 291.658323 0 0 0-8.968258-14.088258l-5.582452-8.092903-7.498323-10.487742-27.813161-37.755871-11.230968-15.591226-3.716129-5.285161-6.854193-10.107871c-13.01471-19.571613-21.685677-35.394065-26.475355-49.003355l-2.378323-7.019355-2.229677-7.217548a304.706065 304.706065 0 0 1-1.073548-3.699613l-2.048-7.613936-1.948904-8.010322-1.866322-8.439742a491.586065 491.586065 0 0 1-0.908387-4.426323l-1.800258-9.282064-1.75071-9.909678-1.734194-10.652903-2.64258-17.507097-4.261161-31.52929-7.035871-53.693935-0.578065-4.211613a1707.668645 1707.668645 0 0 0-9.282064-60.085678l-2.048-11.363097-0.908388-4.294193-1.139612-5.004387-3.022452-12.056774-2.906839-10.867613-4.740129-16.912516-8.91871-30.587871-3.468387-11.594323a36.665806 36.665806 0 0 1 35.096775-47.236129h6.887225a74.322581 74.322581 0 0 1 68.01342 44.362323l60.49858 137.282064-2.163613-395.842064a53.776516 53.776516 0 0 1 53.776517-53.76 54.123355 54.123355 0 0 1 54.139871 54.123354V421.326452l16.516129 0.330322 13.146838-338.085161a61.175742 61.175742 0 0 1 61.126194-58.797419z",fill:"#D5935D","p-id":"14594"})]})},o=function(e){var t=e.style;return(0,a.jsxs)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"21347",style:t,children:[(0,a.jsx)("path",{d:"M676.7 393.8c38.9-28.3 74.2-55.5 106.7-84.7 46.4-41.6 75.7-105.1 89.7-141.1-7 4.1-77.1 45.3-112.9 73.8-37.7 30-239.7 210.5-256.3 221.4-16.6 10.9-15.3 6.5-23.7 13.7s-10.5 9.1-10.5 9.1l69.4 80.4 19 13.2c0.6 0.4 1.3 0.3 1.8-0.1l8.3-7.2c0.6-0.5 0.7-1.3 0.3-1.9-1.9-2.8-6.4-10.8-3.9-17.6-5.1-7.6-12.1-19.5-14.6-30.3-8.7-37 93.1-104.2 126.7-128.7z",fill:"#B5C2C4","p-id":"21348"}),(0,a.jsx)("path",{d:"M783.4 309.2c-32.5 29.2-67.9 56.4-106.7 84.7-33.6 24.5-135.4 91.7-126.6 128.7 2.6 10.8 9.6 22.6 14.6 30.3 0.5-1.5 1.4-2.9 2.7-4.2 7.1-7.2 17.3-2.8 21.3-0.6 1 0.6 2.3 0.3 3.1-0.6 8.3-9.8 52.4-62.1 86.1-94.1C715.2 418 794.3 369.8 838.4 319c54.7-63 35.2-151.2 35.2-151.2l-0.6 0.3c-13.8 36-43.2 99.4-89.6 141.1z",fill:"#D7E0E2","p-id":"21349"}),(0,a.jsx)("path",{d:"M521.7 512c-12.7-12.4-52-25.9-52-25.9s-215 178.5-274.5 254.1c-33.4 42.4-55.2 86.8-66.8 109.1-3.9 7.4-3.2 16.4 1.7 23.1 5.7 7.8 14 17.8 23.1 24.1 1.7 1.2 4 2.1 6.6 2.9 13.4-25 36.9-69.3 70.9-112.3 59.2-74.7 256.8-245.7 291-275.1z",fill:"#515151","p-id":"21350"}),(0,a.jsx)("path",{d:"M230.8 787c-34 43-57.4 87.3-70.9 112.3 15.7 4.5 52.5 4.9 70.4 3 8.8-0.9 16.3-6.7 19.4-15 7.5-19.9 18.7-56.5 35.1-74.7 23-25.5 66.7-39.6 73.7-48.4 7-8.8 13.8-49.7 30.5-67.2s59.7-24.1 66.7-32c6.9-7.9 15.3-53.1 29.4-65.3 14.2-12.2 58-30.4 58-30.4l5.4-5.2c1.9-1.6 2.5-4.4 1.4-6.6-4-8.6-14.4-29.5-26.9-44-0.4-0.5-0.9-0.9-1.3-1.4-34.2 29.3-231.8 200.3-290.9 274.9z",fill:"#6D6D6D","p-id":"21351"}),(0,a.jsx)("path",{d:"M203.17675 813.257656a15.6 15.6 0 1 0 27.726107-14.307447 15.6 15.6 0 1 0-27.726107 14.307447Z",fill:"#D7E0E2","p-id":"21352"}),(0,a.jsx)("path",{d:"M207.33 801.423l2.442-3.294 17.03 12.627-2.442 3.294z",fill:"#B5C2C4","p-id":"21353"}),(0,a.jsx)("path",{d:"M221.646 796.378l3.293 2.442-12.627 17.03-3.293-2.442z",fill:"#B5C2C4","p-id":"21354"}),(0,a.jsx)("path",{d:"M427.719821 585.32046a15.6 15.6 0 1 0 29.930134-8.810621 15.6 15.6 0 1 0-29.930134 8.810621Z",fill:"#D7E0E2","p-id":"21355"}),(0,a.jsx)("path",{d:"M434.023 574.447l3.02-2.773 14.337 15.616-3.02 2.773z",fill:"#B5C2C4","p-id":"21356"}),(0,a.jsx)("path",{d:"M449.158 572.262l2.772 3.02-15.615 14.338-2.773-3.02z",fill:"#B5C2C4","p-id":"21357"})]})},u=n(7568),d=n(7582),m=n(357),f=n.n(m),h=n(2222),x=Math.random()>.5?"sister":"brother",v=!1,g=[],p=0,j=[],y=0,N=null;function b(e,t){if(e===t)return 1;if(0===e.length||0===t.length)return 0;var n=new Set(e),a=new Set(t),s=new Set(Array.from(n).filter(function(e){return a.has(e)})),r=new Set((0,c.Z)(Array.from(n)).concat((0,c.Z)(Array.from(a))));return s.size/r.size}function w(){return(w=(0,u.Z)(function(e){var t,n,a,s,r,i,c;return(0,d.__generator)(this,function(l){switch(l.label){case 0:if(t=function(t){var n,s,i,c,l,o,u,m,f;return(0,d.__generator)(this,function(o){switch(o.label){case 0:return o.trys.push([0,9,,12]),p=a,i=new AbortController,c=setTimeout(function(){return i.abort()},1e4),[4,fetch("https://api.haihub.cn/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("sk-cfa87ed7-f671-4e47-88b2-fb30d52d0311")},body:JSON.stringify({model:"DeepSeek-V3.1",messages:[{role:"system",content:r+(j.length>0?"\n\n【严格避免重复】你之前说过这些话，绝对不能再说：".concat(j.join("、")):"")},{role:"user",content:"玩家当前事件：".concat(e,"。请生成一句完全不同的话，第").concat(t,"次尝试。")}],temperature:Math.min(1.5,.8+.15*t),max_tokens:60,top_p:.95,frequency_penalty:Math.min(2,.8+.2*t),presence_penalty:Math.min(2,.6+.2*t)}),signal:i.signal})];case 1:if(l=o.sent(),clearTimeout(c),429!==l.status)return[3,4];if(console.log("API请求频率限制，第".concat(t,"次重试，等待").concat(2*t,"秒后重试...")),!(t<5))return[3,3];return[4,new Promise(function(e){return setTimeout(e,2e3*t)})];case 2:case 6:return o.sent(),[2,"continue"];case 3:throw Error("API请求频率限制，已达到最大重试次数");case 4:if(!l.ok)throw Error("HTTP error! status: ".concat(l.status));return[4,l.json()];case 5:var d;if(m=(d=u=null===(n=o.sent().choices[0])||void 0===n?void 0:null===(s=n.message)||void 0===s?void 0:s.content)?d.replace(/\([^)]*\)/g,"").replace(/（[^）]*）/g,"").replace(/\[[^\]]*\]/g,"").replace(/【[^】]*】/g,"").replace(/\{[^}]*\}/g,"").replace(/〔[^〕]*〕/g,"").replace(/＜[^＞]*＞/g,"").replace(/《[^》]*》/g,"").trim():"",console.log("AI原始响应(第".concat(t,"次尝试)："),u),!function(e){if(!e||""===e.trim())return!0;var t=e.trim();if(j.includes(t))return!0;var n=!0,a=!1,s=void 0;try{for(var r,i=j[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var c=r.value;if(b(t,c)>.8)return console.log('发现相似消息: "'.concat(t,'" 与 "').concat(c,'" 相似度过高')),!0}}catch(l){a=!0,s=l}finally{try{n||null==i.return||i.return()}finally{if(a)throw s}}return!1}(m))return[3,8];if(console.log("检测到重复/相似消息，第".concat(t,"次重试...")),!(t<5))return[3,7];return[4,new Promise(function(e){return setTimeout(e,800)})];case 7:return console.log("重试次数用完，使用默认消息"),[2,{v:""}];case 8:if(m&&""!==m.trim())return function(e){if(e&&""!==e.trim()){var t=e.trim();j.push(t),j.length>20&&j.shift()}}(m),[2,{v:m}];return[2,{v:""}];case 9:if(f=o.sent(),console.error("AI请求错误 (第".concat(t,"次尝试):"),f),5===t)return console.log("使用默认夸奖消息"),[2,{v:""}];if(!(t<5))return[3,11];return[4,new Promise(function(e){return setTimeout(e,1e3*t)})];case 10:o.sent(),o.label=11;case 11:return[3,12];case 12:return[2]}})},n="sister"===x,(a=Date.now())-p<2500)return console.log("请求过于频繁，使用默认消息"),[2,""];y++,s="【用户此刻的状态/场景】"+e,r=n?"你是一个极度肉麻、软萌的撒娇甜妹，正在陪最崇拜的小哥哥玩游戏。\n【核心要求】每句话都要带明显的撒娇尾音（如：嘛、哒、喔、呢），语气要拉丝、充满崇拜感。\n".concat(s,"\n\n\n【创新要求】\n1. 字数控制在0-12字之间，避免固定长度\n2. 直接输出肉麻夸奖，不带任何前缀和引号\n3. 绝对不要输出括号内的动作描述，如（轻笑）（叹气）等\n4. 每次回复都必须完全创新，绝对不能重复任何之前说过的话\n5. 多使用不同的撒娇词汇和表达方式\n6. 尝试组合不同的词汇创造全新表达\n7. 当前是第").concat(y,"次对话，请确保内容完全不同"):"你是一个拥有磁性气泡音、深情且霸道的宠溺系小哥哥，正在看心爱的小姐姐玩游戏。\n【核心要求】语速缓慢，带着若有若无的笑意，语气要暧昧、甚至带点诱惑感。\n".concat(s,"\n\n\n【创新要求】\n1. 字数控制0-12字之间，避免固定长度\n2. 直接输出肉麻夸奖，不带任何前缀和引号\n3. 绝对不要输出括号内的动作描述，如（轻笑）（叹气）等\n4. 每次回复都必须完全创新，绝对不能重复任何之前说过的话\n5. 多使用不同的深情词汇和表达方式\n6. 尝试组合不同的词汇创造全新表达\n7. 当前是第").concat(y,"次对话，请确保内容完全不同"),i=1,l.label=1;case 1:if(!(i<=5))return[3,4];return[5,(0,d.__values)(t(i))];case 2:if(c=l.sent(),"object"===(0,h.Z)(c))return[2,c.v];l.label=3;case 3:return i++,[3,1];case 4:return[2,""]}})})).apply(this,arguments)}function S(){N&&(N.volume=.2)}function C(){if(0!==g.length&&!v){var e=g.shift();e&&D(e)}}function D(e){if(window.speechSynthesis){v=!0,N&&(N.volume=.020000000000000004);var t=new SpeechSynthesisUtterance(e);t.lang="zh-CN";var n=window.speechSynthesis.getVoices(),a=null;"sister"===x?(a=n.find(function(e){return e.lang.includes("zh")&&(e.name.includes("Female")||e.name.includes("女")||e.name.includes("美嘉")||e.name.includes("Yaoyao")||e.name.includes("Xiaoyi")||e.name.includes("Xiaomo"))})||n.find(function(e){return e.lang.includes("zh")}),t.pitch=1.25,t.rate=.95,t.volume=.85):((a=n.find(function(e){return e.lang.includes("zh")&&(e.name.includes("Reed")||e.name.includes("男")||e.name.includes("Yunyang")||e.name.includes("Kangkang"))}))||(a=n.find(function(e){return e.name.toLowerCase().includes("male")||e.name.toLowerCase().includes("david")||e.name.toLowerCase().includes("mark")})),a||(a=n.find(function(e){return e.lang.includes("zh")})),t.pitch=.3,t.rate=.7,t.volume=1),a&&(t.voice=a),console.log("开始播放语音: ".concat(e)),t.onend=function(){console.log("语音播放完成"),v=!1,S(),C()},t.onerror=function(){console.log("语音播放出错"),v=!1,S(),C()},window.speechSynthesis.speak(t)}}function M(e){var t,n=e.event,r=(0,s.useState)(""),i=r[0],c=r[1],l=(0,s.useState)(!1),o=l[0],m=l[1],h=(0,s.useRef)(!0),g=(0,s.useRef)(null),p=(0,s.useCallback)((t=(0,u.Z)(function(e){var t,n;return(0,d.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,function(e){return w.apply(this,arguments)}(e)];case 1:if(!(t=a.sent())||!h.current)return[2];return c(t),m(!0),function(e){if(e&&""!==e.trim()){if(v){console.log("语音正在播放中，忽略新语音: ".concat(e.trim()));return}D(e.trim())}}(t),g.current&&clearTimeout(g.current),g.current=setTimeout(function(){h.current&&m(!1)},3e3),[3,3];case 2:return n=a.sent(),console.error("触发语音时出错:",n),[3,3];case 3:return[2]}})}),function(e){return t.apply(this,arguments)}),[]);if((0,s.useEffect)(function(){n&&p(n)},[n,p]),(0,s.useEffect)(function(){return function(){h.current=!1,g.current&&clearTimeout(g.current)}},[]),!o||!i||""===i.trim())return null;var j="sister"===x?"rgba(255, 105, 180, 0.9)":"rgba(30, 144, 255, 0.9)";return(0,a.jsxs)("div",{className:f().dynamic([["43b0dc29f573e47d",[j,j]]])+" roast-bubble",children:[(0,a.jsx)("div",{className:f().dynamic([["43b0dc29f573e47d",[j,j]]])+" roast-content",children:i}),(0,a.jsx)(f(),{id:"43b0dc29f573e47d",dynamic:[j,j],children:".roast-bubble.__jsx-style-dynamic-selector{position:absolute;top:80px;right:20px;background:".concat(j,';color:#fff;padding:10px 15px;-webkit-border-radius:15px;-moz-border-radius:15px;border-radius:15px;-webkit-border-bottom-right-radius:2px;-moz-border-radius-bottomright:2px;border-bottom-right-radius:2px;max-width:200px;z-index:1000;-webkit-animation:slideIn.3s ease-out;-moz-animation:slideIn.3s ease-out;-o-animation:slideIn.3s ease-out;animation:slideIn.3s ease-out;font-size:14px;line-height:1.4;-webkit-box-shadow:0 4px 15px rgba(0,0,0,.3);-moz-box-shadow:0 4px 15px rgba(0,0,0,.3);box-shadow:0 4px 15px rgba(0,0,0,.3)}.roast-bubble.__jsx-style-dynamic-selector::after{content:"";position:absolute;bottom:-10px;right:10px;border-width:10px 10px 0 0;border-style:solid;border-color:').concat(j," transparent transparent transparent}@-webkit-keyframes slideIn{from{opacity:0;-webkit-transform:translateX(20px);transform:translateX(20px)}to{opacity:1;-webkit-transform:translateX(0);transform:translateX(0)}}@-moz-keyframes slideIn{from{opacity:0;-moz-transform:translateX(20px);transform:translateX(20px)}to{opacity:1;-moz-transform:translateX(0);transform:translateX(0)}}@-o-keyframes slideIn{from{opacity:0;-o-transform:translateX(20px);transform:translateX(20px)}to{opacity:1;-o-transform:translateX(0);transform:translateX(0)}}@keyframes slideIn{from{opacity:0;-webkit-transform:translateX(20px);-moz-transform:translateX(20px);-o-transform:translateX(20px);transform:translateX(20px)}to{opacity:1;-webkit-transform:translateX(0);-moz-transform:translateX(0);-o-transform:translateX(0);transform:translateX(0)}}")})]})}function k(e){var t=e.isActive,n=e.timeout,a=e.onTimeout,r=(0,s.useState)(!1),i=r[0],c=r[1],l=(0,s.useRef)(null),o=function(){l.current&&clearTimeout(l.current),c(!1),t&&(l.current=setTimeout(function(){i||(c(!0),a())},n))},u=function(){l.current&&(clearTimeout(l.current),l.current=null),c(!1)};return(0,s.useEffect)(function(){return t?o():u(),function(){u()}},[t,n]),(0,s.useEffect)(function(){return function(){u()}},[]),{resetTimer:o,stopTimer:u,hasTriggered:i}}function T(e){var t=e.onSuccess,n=e.onFail,u=(0,s.useState)("intro"),d=u[0],m=u[1],f=(0,s.useState)(30),h=f[0],x=f[1],v=(0,s.useState)(0),g=v[0],p=v[1],j=(0,s.useState)(380),y=j[0],N=j[1],b=(0,s.useState)(450),w=b[0],S=b[1],C=(0,s.useState)(!1),D=C[0],T=C[1],E=(0,s.useState)([]),z=E[0],I=E[1],A=(0,s.useState)(null),X=A[0],_=A[1],Z=(0,s.useRef)(null),B=(0,s.useRef)(null),R=k({isActive:"playing"===d,timeout:2e3,onTimeout:function(){_("速度太慢，一动不动。 时间：".concat(Date.now()))}}).resetTimer,F=function(e){if("playing"===d&&Z.current){var t=Z.current.getBoundingClientRect(),n=e.clientX-t.left;n>80&&n<550&&S(n)}},L=function(){m("playing"),x(30),p(0)};(0,s.useEffect)(function(){return"playing"===d&&(B.current=setInterval(function(){x(function(e){return e<=0?(clearInterval(B.current),_("时间到了！没完成切黄瓜游戏。 时间：".concat(Date.now())),setTimeout(n,2e3),0):e-1})},1e3)),function(){B.current&&clearInterval(B.current)}},[d]),(0,s.useEffect)(function(){if(z.some(function(e){return!e.inPlate})){var e=setInterval(function(){I(function(e){return e.map(function(e){if(e.inPlate)return e;var t=e.x+e.vx,n=e.y+e.vy,a=e.vy+.3;return t>580&&n>180?(0,i.Z)((0,r.Z)({},e),{x:600+80*Math.random(),y:160+20*Math.random(),inPlate:!0,vx:0,vy:0}):(0,i.Z)((0,r.Z)({},e),{x:t,y:n,vy:a,rotation:e.rotation+10})})})},30);return function(){return clearInterval(e)}}},[z]);var P=function(){if("playing"===d){if(R(),w>50+(500-25*g)+15){T(!0),_("切空了,玩家在空气中挥刀，没切到黄瓜。 时间：".concat(Date.now())),setTimeout(function(){return T(!1)},150);return}if(T(!0),w>y&&w<y+150||w<y)_("切到了手！手流血了。 时间：".concat(Date.now())),m("fail"),setTimeout(n,2e3);else{var e,a=Date.now();_("玩家在切黄瓜 时间：".concat(Date.now()));var s=640-w;e=s<100?2+s/50:4+s/80,I(function(t){return(0,c.Z)(t).concat([{id:a,x:w,y:150,vx:e+1*Math.random(),vy:-3-1*Math.random(),rotation:0,inPlate:!1}])}),p(function(e){var n=e+1;return N(function(){return 380-25*n}),n>=20&&(_("把黄瓜切完了！ 时间：".concat(Date.now())),m("success"),setTimeout(t,2e3)),n})}setTimeout(function(){return T(!1)},150)}};return(0,a.jsxs)("div",{className:"cucumber-stage",ref:Z,onMouseMove:F,children:["intro"===d&&(0,a.jsx)("div",{className:"overlay cucumber-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsxs)("div",{className:"dialog-header",children:[(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/xiaozhan.jpeg",alt:"着急的厨师"})}),(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/yanzi.jpeg",alt:"燕姿"})})]}),(0,a.jsx)("div",{className:"dialog-title",children:"着急的厨师 v.s 切菜小帮手燕姿"}),(0,a.jsxs)("div",{className:"dialog-content",children:["任务时间：30秒",(0,a.jsx)("br",{}),"任务方式：利用鼠标点选菜刀，将砧板上的小黄瓜切完即可。",(0,a.jsx)("br",{}),"（注意喔~不要切到燕姿的娇嫩的小手喔！）"]}),(0,a.jsx)("button",{className:"btn-start",onClick:L,children:"开始切小黄瓜"})]})}),"playing"===d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"timer-container",children:[(0,a.jsx)("div",{className:"timer-icon"}),(0,a.jsx)("div",{className:"timer-bar",children:(0,a.jsx)("div",{className:"timer-fill",style:{width:"".concat(h/30*100,"%")}})})]}),(0,a.jsxs)("div",{className:"chopping-board",children:[(0,a.jsx)("div",{className:"cucumber-plate"}),(0,a.jsx)("div",{className:"cucumber-body",style:{width:"".concat(500-25*g,"px"),transition:"width 0.1s ease"}}),(0,a.jsx)("div",{className:"hand-yanzi",style:{left:"".concat(y,"px")},children:(0,a.jsx)(l,{style:{width:"100%",height:"100%",transform:"rotate(90deg)"}})}),(0,a.jsx)("div",{className:"knife-tool ".concat(D?"down":""),style:{left:"".concat(w-75,"px")},onClick:P,children:(0,a.jsx)(o,{style:{width:"100%",height:"100%",transform:"rotate(-45deg)"}})}),z.map(function(e){return(0,a.jsx)("div",{className:"slice-particle",style:{left:e.x,top:e.y,transform:"rotate(".concat(e.rotation,"deg)")}},e.id)})]}),(0,a.jsxs)("div",{className:"completion-container",children:[(0,a.jsx)("span",{children:"完成度："}),(0,a.jsx)("div",{className:"completion-bar",children:(0,a.jsx)("div",{className:"completion-fill",style:{width:"".concat(g/20*100,"%")}})})]})]}),(0,a.jsx)(M,{event:X,gameContext:"fail"===d?"切到手受伤流血":"success"===d?"成功完成切黄瓜":"正在切黄瓜"}),"success"===d&&(0,a.jsx)("div",{className:"overlay cucumber-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsx)("div",{className:"dialog-header success-header",children:(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/xiaozhan.jpeg",alt:"肖战"})})}),(0,a.jsx)("h2",{className:"dialog-title",children:"成功！"}),(0,a.jsxs)("p",{className:"dialog-content",style:{textAlign:"center"},children:["谢谢你即时帮我把小黄瓜切好！",(0,a.jsx)("br",{}),"我有看到小偷往 巷子内 跑过去了..."]})]})}),"fail"===d&&(0,a.jsx)("div",{className:"overlay cucumber-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsx)("div",{className:"dialog-header fail-header",children:(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/blood.jpeg",alt:"受伤"})})}),(0,a.jsx)("h2",{className:"dialog-title",style:{color:"red"},children:"失败！"}),(0,a.jsx)("p",{className:"dialog-content",style:{textAlign:"center"},children:"啊！好痛！不要切我的手！"})]})})]})}function E(e){var t=e.onSuccess,n=e.onFail,l=(0,s.useState)("intro"),o=l[0],u=l[1],d=(0,s.useState)(40),m=d[0],f=d[1],h=(0,s.useState)(0),x=h[0],v=h[1],g=(0,s.useState)([]),p=g[0],j=g[1],y=(0,s.useState)([]),N=y[0],b=y[1],w=(0,s.useState)(null),S=w[0],C=w[1],D=(0,s.useState)({x:0,y:0}),T=D[0],E=D[1],z=(0,s.useState)(null),I=z[0],A=z[1],X=(0,s.useRef)(null),_=(0,s.useRef)(null),Z=(0,s.useRef)(null),B=k({isActive:"playing"===o,timeout:3e3,onTimeout:function(){A("速度太慢，用户一动不动 时间：".concat(Date.now()))}}).resetTimer,R=function(){u("playing"),f(40),v(0),b([]),F()},F=function(){for(var e=[],t=0;t<20;t++){var n=2*Math.random()*Math.PI,a=120*Math.sqrt(Math.random()),s=150+a*Math.cos(n)-25,r=150+a*Math.sin(n)-25;e.push({id:t,x:Math.max(0,Math.min(s,250)),y:Math.max(0,Math.min(r,250)),rotation:360*Math.random()})}j(e)};(0,s.useEffect)(function(){return"playing"===o&&(X.current=setInterval(function(){f(function(e){return e<=0?(clearInterval(X.current),A("时间到了！没完成任务。 时间：".concat(Date.now())),u("fail"),setTimeout(n,2e3),0):e-1})},1e3)),function(){X.current&&clearInterval(X.current)}},[o]);var L=function(e,t){e.preventDefault();var n=p.find(function(e){return e.id===t});if(n&&_.current&&!n.isCollected){B();var a=_.current.getBoundingClientRect(),s=e.clientX-a.left-n.x,c=e.clientY-a.top-n.y;C(t),E({x:s,y:c}),j(function(e){return e.map(function(e){return e.id===t?(0,i.Z)((0,r.Z)({},e),{isDragging:!0,originalX:e.x,originalY:e.y}):e})})}},P=function(e){if(null!==S&&_.current){var t=_.current.getBoundingClientRect(),n=e.clientX-t.left-T.x,a=e.clientY-t.top-T.y;j(function(e){return e.map(function(e){return e.id===S?(0,i.Z)((0,r.Z)({},e),{x:n,y:a}):e})})}},O=function(e){if(null!==S&&_.current&&Z.current){var n,a=_.current.getBoundingClientRect(),s=Z.current.getBoundingClientRect(),l=e.clientX-a.left,o=e.clientY-a.top,d=s.left-a.left+s.width/2,m=s.top-a.top+s.height/2;if(Math.sqrt(Math.pow(l-d,2)+Math.pow(o-m,2))<=s.width/2){console.log("SUCCESS! Collecting leaf"),A("摘茶叶中 时间：".concat(Date.now()));var f=p.find(function(e){return e.id===S});if(f){var h=(0,i.Z)((0,r.Z)({},f),{x:75+(Math.random()-.5)*50,y:75+(Math.random()-.5)*50,rotation:360*Math.random(),isDragging:!1,isCollected:!0});b(function(e){return(0,c.Z)(e).concat([h])})}j(function(e){return e.filter(function(e){return e.id!==S})}),v(function(e){var n=e+1;return n>=15&&(u("success"),setTimeout(t,2e3)),n})}else console.log("FAILED! Returning to original position"),A("茶叶掉了 时间：".concat(Date.now())),j(function(e){return e.map(function(e){return e.id===S?(0,i.Z)((0,r.Z)({},e),{x:e.originalX||e.x,y:e.originalY||e.y,isDragging:!1}):e})});C(null),E({x:0,y:0})}};return(0,a.jsxs)("div",{className:"tea-stage",children:["intro"===o&&(0,a.jsx)("div",{className:"overlay tea-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsxs)("div",{className:"dialog-header",children:[(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/xiaozhan.jpeg",alt:"茶店老板"})}),(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/yanzi.jpeg",alt:"燕姿"})})]}),(0,a.jsx)("div",{className:"dialog-title",children:"巷口青草茶店"}),(0,a.jsxs)("div",{className:"dialog-content",children:["任务：帮老板捡选晒在门口的绿茶叶。",(0,a.jsx)("br",{}),"方式：用鼠标拖拽篮子里的茶叶到右边的杯中。",(0,a.jsx)("br",{}),"老板就会愿意告诉燕姿小偷往哪去了喔！"]}),(0,a.jsx)("button",{className:"btn-start",onClick:R,children:"开始摘茶叶"})]})}),"playing"===o&&(0,a.jsxs)("div",{className:"game-content",children:[(0,a.jsxs)("div",{className:"timer-container",children:[(0,a.jsx)("div",{className:"timer-icon",children:"⏰"}),(0,a.jsx)("div",{className:"timer-bar",children:(0,a.jsx)("div",{className:"timer-fill",style:{width:"".concat(m/40*100,"%"),background:m<10?"linear-gradient(90deg, #f44336, #ff5722)":void 0}})})]}),(0,a.jsxs)("div",{className:"tea-area",ref:_,onMouseMove:P,onMouseUp:O,children:[(0,a.jsx)("div",{className:"bamboo-tray",children:(0,a.jsx)("div",{className:"tea-leaves-container",children:p.map(function(e){return(0,a.jsx)("div",{className:"tea-leaf ".concat(e.isDragging?"dragging":""," ").concat(e.isCollected?"collected":""),style:{left:e.x,top:e.y,zIndex:e.isDragging?1e3:e.isCollected?10:1,cursor:e.isCollected?"default":"pointer"},onMouseDown:function(t){return L(t,e.id)},children:(0,a.jsxs)("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("ellipse",{cx:"25",cy:"25",rx:"8",ry:"20",fill:"#4a7c2c",transform:"rotate(".concat(e.rotation," 25 25)")}),(0,a.jsx)("ellipse",{cx:"25",cy:"25",rx:"6",ry:"18",fill:"#5a9c3c",transform:"rotate(".concat(e.rotation," 25 25)")}),(0,a.jsx)("line",{x1:"25",y1:"10",x2:"25",y2:"40",stroke:"#2d5016",strokeWidth:"1"})]})},e.id)})})}),(0,a.jsx)("div",{className:"tea-bowl",ref:Z,children:N.map(function(e){return(0,a.jsx)("div",{className:"tea-leaf collected",style:{left:e.x,top:e.y,position:"absolute",zIndex:10},children:(0,a.jsxs)("svg",{viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("ellipse",{cx:"25",cy:"25",rx:"8",ry:"20",fill:"#4a7c2c",transform:"rotate(".concat(e.rotation," 25 25)")}),(0,a.jsx)("ellipse",{cx:"25",cy:"25",rx:"6",ry:"18",fill:"#5a9c3c",transform:"rotate(".concat(e.rotation," 25 25)")}),(0,a.jsx)("line",{x1:"25",y1:"10",x2:"25",y2:"40",stroke:"#2d5016",strokeWidth:"1"})]})},"collected-".concat(e.id))})})]}),(0,a.jsxs)("div",{className:"completion-container completion-container-tea",children:[(0,a.jsxs)("span",{children:["收集进度：",x,"/",15]}),(0,a.jsx)("div",{className:"completion-bar",children:(0,a.jsx)("div",{className:"completion-fill",style:{width:"".concat(x/15*100,"%")}})})]})]}),(0,a.jsx)(M,{event:I,gameContext:"fail"===o?"泡茶失败烫到手":"success"===o?"成功泡好茶":"正在泡茶"}),"fail"===o&&(0,a.jsx)("div",{className:"overlay tea-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsx)("div",{className:"dialog-header success-header",children:(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/fail.jpg",alt:"失败"})})}),(0,a.jsx)("h2",{className:"dialog-title",children:"时间到了！"}),(0,a.jsxs)("p",{className:"dialog-content",style:{textAlign:"center"},children:["你收集了 ",x," 片茶叶",(0,a.jsx)("br",{}),"差一点就成功了，再试一次吧！"]})]})}),"success"===o&&(0,a.jsx)("div",{className:"overlay tea-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsx)("div",{className:"dialog-header success-header",children:(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/xiaozhan.jpeg",alt:"肖战"})})}),(0,a.jsx)("h2",{className:"dialog-title",children:"成功！"}),(0,a.jsxs)("p",{className:"dialog-content",style:{textAlign:"center"},children:["太棒了！你成功收集了所有茶叶！",(0,a.jsx)("br",{}),"茶店老板很满意！"]})]})})]})}function z(e){var t=e.onSuccess,n=e.onFail,l=(0,s.useState)("intro"),o=l[0],u=l[1],d=(0,s.useState)(45),m=d[0],f=d[1],h=(0,s.useState)(5),x=h[0],v=h[1],g=(0,s.useState)([]),p=g[0],j=g[1],y=(0,s.useState)(!1),N=y[0],b=y[1],w=(0,s.useState)(null),S=w[0],C=w[1],D=(0,s.useRef)(null),T=(0,s.useRef)(null),E=(0,s.useRef)(null),z=["\uD83D\uDE97","\uD83D\uDE99","\uD83D\uDE95","\uD83D\uDE8C","\uD83C\uDFCE️"],I=k({isActive:"playing"===o,timeout:3e3,onTimeout:function(){C("速度太慢，用户一动不动 时间：".concat(Date.now()))}}).resetTimer,A=function(){u("playing"),f(45),v(5),j([]),b(!1)};(0,s.useEffect)(function(){if("playing"===o){D.current=setInterval(function(){f(function(e){return e<=0?(clearInterval(D.current),C("时间到了，老奶奶没到终点 时间：".concat(Date.now())),u("fail"),setTimeout(n,2e3),0):e-1})},1e3),T.current=setInterval(function(){var e=Math.floor(3*Math.random());j(function(t){return(0,c.Z)(t).concat([{id:Date.now(),lane:e,left:-100,speed:4+6*Math.random(),emoji:z[Math.floor(Math.random()*z.length)]}])})},1200);var e=function(){j(function(e){var t=e.map(function(e){return(0,i.Z)((0,r.Z)({},e),{left:e.left+e.speed})}).filter(function(e){return e.left<900}),n=document.getElementById("grandma-player");if(n){var a=n.getBoundingClientRect(),s=!0,c=!1,l=void 0;try{for(var o,u=t[Symbol.iterator]();!(s=(o=u.next()).done);s=!0){var d=o.value,m=document.getElementById("car-".concat(d.id));if(m){var f=m.getBoundingClientRect();a.right<f.left||a.left>f.right||a.bottom<f.top||a.top>f.bottom||X()}}}catch(h){c=!0,l=h}finally{try{s||null==u.return||u.return()}finally{if(c)throw l}}}return t}),E.current=requestAnimationFrame(e)};E.current=requestAnimationFrame(e)}return function(){D.current&&clearInterval(D.current),T.current&&clearInterval(T.current),E.current&&cancelAnimationFrame(E.current)}},[o]);var X=function(){N||(b(!0),C("老奶奶被车撞了。 时间：".concat(Date.now())),v(function(e){return Math.max(5,e-12)}),setTimeout(function(){return b(!1)},500))},_=function(){"playing"!==o||N||(I(),C("在帮老奶奶过马路 时间：".concat(Date.now())),v(function(e){var n=e+8;return n>=85?(u("success"),setTimeout(t,2e3),85):n}))};return(0,a.jsxs)("div",{className:"road-stage",children:["intro"===o&&(0,a.jsx)("div",{className:"overlay oldlady-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsxs)("div",{className:"dialog-header",children:[(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/grandma.jpeg",alt:"老奶奶"})}),(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/yanzi.jpeg",alt:"燕姿"})})]}),(0,a.jsx)("div",{className:"dialog-title",children:"帮助老奶奶过马路"}),(0,a.jsxs)("div",{className:"dialog-content",children:["方式：用鼠标点击路面让老奶奶前进。",(0,a.jsx)("br",{}),"注意：一定要避开左右行驶的车辆喔！",(0,a.jsx)("br",{}),"老奶奶：谢谢你，年轻人，能帮我过马路吗？"]}),(0,a.jsx)("button",{className:"btn-start",onClick:A,children:"帮助老奶奶过马路"})]})}),"playing"===o&&(0,a.jsxs)("div",{className:"game-content oldlady-game-content",children:[(0,a.jsxs)("div",{className:"oldlady-top-info",children:[(0,a.jsxs)("div",{className:"timer-container oldlady-timer-container",children:[(0,a.jsx)("div",{className:"timer-icon",children:"⏰"}),(0,a.jsx)("div",{className:"timer-bar oldlady-timer-bar",children:(0,a.jsx)("div",{className:"timer-fill ".concat(m<10?"oldlady-timer-fill-danger":""),style:{width:"".concat(m/45*100,"%")}})})]}),(0,a.jsx)("div",{className:"oldlady-destination",children:"目的地"})]}),(0,a.jsxs)("div",{className:"road-scene oldlady-road-scene",onClick:_,children:[(0,a.jsxs)("div",{className:"road",children:[(0,a.jsx)("div",{className:"lane oldlady-lane-0"}),(0,a.jsx)("div",{className:"lane oldlady-lane-1"}),(0,a.jsx)("div",{className:"lane oldlady-lane-2"}),p.map(function(e){return(0,a.jsx)("div",{id:"car-".concat(e.id),className:"car",style:{left:"".concat(e.left,"px"),top:"".concat(33.33*e.lane+5,"%")},children:e.emoji},e.id)})]}),(0,a.jsx)("div",{id:"grandma-player",className:"grandma ".concat(N?"hit":""),style:{bottom:"".concat(x+15,"%")},children:"\uD83D\uDC75"})]}),(0,a.jsxs)("div",{className:"oldlady-instructions",children:["方式：用鼠标点击路面让老太太前进。",(0,a.jsx)("br",{}),"注意：一定要避开左右行驶的车辆喔！",(0,a.jsx)("br",{})]}),(0,a.jsxs)("div",{className:"completion-container",children:[(0,a.jsx)("span",{children:"路程进度："}),(0,a.jsx)("div",{className:"completion-bar",children:(0,a.jsx)("div",{className:"completion-fill",style:{width:"".concat((x-5)/80*100,"%")}})})]})]}),(0,a.jsx)(M,{event:S,gameContext:"fail"===o?"被老奶奶发现失败":"success"===o?"成功拿到薯片":"正在偷薯片"}),"success"===o&&(0,a.jsx)("div",{className:"overlay oldlady-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsx)("div",{className:"dialog-header success-header",children:(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/grandma.jpeg",alt:"老奶奶"})})}),(0,a.jsx)("h2",{className:"dialog-title",children:"成功！"}),(0,a.jsxs)("p",{className:"dialog-content oldlady-success-content",children:["太棒了！你成功帮助老太太过马路了！",(0,a.jsx)("br",{}),"老太太：谢谢你，年轻人！你真是个好心人！"]})]})}),"fail"===o&&(0,a.jsx)("div",{className:"overlay oldlady-intro-overlay",children:(0,a.jsxs)("div",{className:"dialog-box",children:[(0,a.jsx)("div",{className:"dialog-header success-header",children:(0,a.jsx)("div",{className:"char-head",children:(0,a.jsx)("img",{src:"/images/gmfail.jpeg",alt:"老奶奶"})})}),(0,a.jsx)("h2",{className:"dialog-title",style:{color:"red"},children:"任务失败"}),(0,a.jsxs)("p",{className:"dialog-content",style:{textAlign:"center"},children:["时间到了！老婆婆还没过完马路呢...",(0,a.jsx)("br",{}),"再试一次吧，注意要快速点击路面喔！"]})]})})]})}function I(){var e=(0,s.useState)("OldLady"),t=e[0],n=e[1],r=(0,s.useState)(!1),i=r[0],c=r[1],l=(0,s.useState)(!1),o=l[0],u=l[1],d=function(){u(!!N&&!N.paused)},m=function(){i||(N?N.paused&&N.play().then(function(){console.log("背景音乐开始播放")}).catch(function(e){console.log("背景音乐播放失败，可能需要用户交互:",e)}):console.log("背景音乐未初始化"),c(!0),setTimeout(d,100))},f=function(){N&&(N.paused?N&&N.paused&&N.play().then(function(){console.log("背景音乐恢复播放")}).catch(function(e){console.log("背景音乐恢复播放失败:",e)}):N&&!N.paused&&(N.pause(),console.log("背景音乐已暂停"))),setTimeout(d,100)};(0,s.useEffect)(function(){window.speechSynthesis&&console.log("语音系统初始化完成，当前人格: ".concat(x)),N||((N=new Audio("/music/Tonight,I feel close to you.mp3")).loop=!0,N.volume=.2,N.preload="auto",console.log("背景音乐初始化完成")),console.log("游戏开始，AI人格: ".concat(x));var e=function(){m(),document.removeEventListener("click",e),document.removeEventListener("keydown",e),document.removeEventListener("touchstart",e)};document.addEventListener("click",e),document.addEventListener("keydown",e),document.addEventListener("touchstart",e);var t=setInterval(d,1e3);return function(){document.removeEventListener("click",e),document.removeEventListener("keydown",e),document.removeEventListener("touchstart",e),clearInterval(t)}},[i]);var h=function(e){("Start"===e||"Cucumber"===e)&&(j=[],y=0,console.log("消息历史记录已清空"),console.log("游戏重新开始，已清理AI消息历史")),n(e)};return(0,a.jsxs)("div",{className:"game-wrapper",children:[i&&(0,a.jsxs)("div",{className:"music-notice",onClick:f,style:{cursor:"pointer"},title:o?"点击暂停音乐":"点击播放音乐",children:[o?"\uD83C\uDFB5":"⏸️"," 孙燕姿《Tonight,I feel close to you》"]}),(0,a.jsxs)("video",{className:"video-background",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,children:[(0,a.jsx)("source",{src:"/3.mp4",type:"video/mp4"}),"您的浏览器不支持视频播放。"]}),(0,a.jsxs)("div",{className:"game-viewport",children:["Start"===t&&(0,a.jsx)("div",{className:"overlay start-overlay",children:(0,a.jsx)("div",{className:"start-button-container",children:(0,a.jsx)("button",{className:"btn-start",onClick:function(){m(),h("Cucumber")},children:"闯关开始"})})}),"Cucumber"===t&&(0,a.jsx)(T,{onSuccess:function(){return h("Tea")},onFail:function(){return h("Fail")}}),"Tea"===t&&(0,a.jsx)(E,{onSuccess:function(){return h("OldLady")},onFail:function(){return h("Fail")}}),"OldLady"===t&&(0,a.jsx)(z,{onSuccess:function(){return h("Success")},onFail:function(){return h("Fail")}}),"Success"===t&&(0,a.jsxs)("div",{className:"overlay result-success-overlay",children:[(0,a.jsx)("h1",{className:"success-dialog-title",children:"任务完成"}),(0,a.jsx)("div",{className:"success-title-section",children:(0,a.jsxs)("p",{className:"success-dialog-content",children:["你太棒了！燕姿终于找回了所有的薯片！",(0,a.jsx)("br",{}),"谢谢你的帮助！"]})}),(0,a.jsx)("div",{className:"success-button-section",children:(0,a.jsx)("button",{className:"btn-start",onClick:function(){return h("Start")},children:"再玩一次"})})]}),"Fail"===t&&(0,a.jsxs)("div",{className:"overlay result-fail-overlay",children:[(0,a.jsxs)("div",{className:"fail-title-section",children:[(0,a.jsx)("h1",{className:"fail-dialog-title",children:"任务失败"}),(0,a.jsx)("p",{className:"fail-dialog-content",children:"哎呀，失败了。哼哼～～"})]}),(0,a.jsx)("div",{className:"fail-button-section",children:(0,a.jsx)("button",{className:"btn-start",onClick:function(){return h("Start")},children:"重新开始"})})]})]})]})}}},function(e){e.O(0,[839,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);